## COW
写时候复制  
fork之后两个进程使用相同的物理空间,子进程代码段,数据段,堆栈都是父进程的物理内存空间.  
父子进程**虚拟空间**不同,但是**物理空间相同**  
当父子进程有相应的更改写入,才会进行内存的复制  
### 机制
fork之后,kernel把父进程所有内存页面权限都设置为**read-only**,然后子进程地址空间指向父进程.  
父子进程都是读取的话不会影响  
某个进程写入内存的时候,**CPU检查到内存是read-only,触发页异常中断**,陷入kernel的一个中断历程.在中断历程中**kernel把触发的异常页面复制一份**,父子进程各自持有独立一份内存空间  
没有MMU的unix系统内核不支持fork机制.  
有MMU的unix同内核在fork的时候对所有**非栈区**的内存标记为**只读**,父子共享.往任何页面写入,MMU会发觉,内核会分配可写页面,更新MMU页表指向新的可写页面.COW支持只需要复制栈空间就可以满足子进程的需求.  

### 消耗
COW在写入的时候会触发页错误,存在内核切换消耗.  


